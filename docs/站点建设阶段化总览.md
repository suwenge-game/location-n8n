# 站点建设阶段化总览

> 先用阶段快速扫一遍顺序，再按任务逐条展开。

## 阶段一览

| 阶段                  | 目标核心                                                   | 建议完成顺序      | 关联系列任务                                                      |
| --------------------- | ---------------------------------------------------------- | ----------------- | ----------------------------------------------------------------- |
| A. 合规与基础设施     | 拿到可备案域名与国内节点，完成工信部/公安备案              | 1 → 4             | T1 域名实名 → T2 云资源 → T3 ICP 备案 → T4 公安备案               |
| B. 工程脚手架         | 建 Next.js 单仓、CI 基线、约束规范                         | 5                 | T5                                                                |
| C. 站点功能与内容体系 | 完成 IA、Markdown/模板库、隐私协议等核心页面与内容生产链路 | 6 → 9 → 16        | T6 路由 → T7 内容系统 → T8 模板库 → T9 隐私/协议 → T16 关键词策略 |
| D. 互动与数据合规     | 评论、订阅、统计埋点，保障数据合规                         | 10 → 12 → 11 → 25 | T10 评论 → T12 RSS/订阅 → T11 统计 → T25 反馈循环                 |
| E. SEO 与站长平台     | Sitemap、结构化数据、站长推送                              | 13 → 14 → 15      | T13 Sitemap/Robots → T14 JSON-LD → T15 百度站长                   |
| F. 本地化与性能       | 去境外依赖、性能指标与安全头                               | 17 → 18 → 19      | T17 本地化 + A11y → T18 性能 → T19 安全头/CSP                     |
| G. 发布与运维         | 自动化部署、监控、灰度与回滚                               | 20 → 21 → 22      | T20 CI/CD → T21 自监控 → T22 灰度回滚                             |
| H. 上线前检查与发布   | 上线检查、发布、站外分发                                   | 23 → 24           | T23 上线检查 → T24 发布分发                                       |

> 依赖关系：除阶段 A 必须率先完成合规前置，阶段 B 可以与 A 并行。C～H 需在具备基本工程脚手架后按表内顺序推进；部分任务（如 T11、T19）依赖前序页面/脚本能力。

---

## 任务详述

### T1 购买域名并完成实名

- **依赖**：无
- **目标产出**：实名通过、关闭隐私保护、WHOIS 信息匹配
- **关键动作**：选国内厂商 → 购可备案后缀 → 完成实名认证 → 临时关闭隐私保护
- **验收**：控制台“实名通过”；WHOIS 显示主体信息

### T2 选择云产品与地域（大陆节点）

- **依赖**：T1
- **目标产出**：阿里云/腾讯云 OSS + CDN，华北/华东节点
- **关键动作**：开通 OSS → 公网读 Bucket → 配 CDN 绑定 Bucket → 临时文件可访问
- **验收**：临时文件能通过 CDN 测试域访问

### T3 ICP 备案（非经营性）

- **依赖**：T1、T2
- **目标产出**：工信部ICP备案号
- **关键动作**：云厂商发起备案 → 上传主体/网站材料 → 核验照片 → 等待审核
- **验收**：备案系统状态通过，获得备案号

### T4 公安网安备案

- **依赖**：T3
- **目标产出**：公安备案号、备案链接
- **关键动作**：属地网安系统登记 → 上传材料 → 审核通过
- **验收**：公安备案号生效并可查询

### T5 初始化代码仓库与工程规范

- **依赖**：无（可与 T1–T4 并行）
- **目标产出**：Next.js (SSG) 单仓 + ESLint/Prettier/Husky/commitlint，CI 运行
- **关键动作**：`npx create-next-app` → 配置 ESLint/Prettier/commitlint → Husky+lint-staged → 锁定 `pnpm`/`yarn` → 主分支保护
- **验收**：`pnpm build`、`pnpm lint` 通过；CI 成功；主分支保护规则生效

### T6 站点信息架构与路由

- **依赖**：T5
- **目标产出**：首页、专题、文章、模板库等路由及导航
- **关键动作**：App Router 路由 → Breadcrumb/TOC → Schema `BreadcrumbList` → 移动端导航
- **验收**：所有页面 200；404/500 正常；移动端导航可用

### T7 Markdown 内容系统与文章模板

- **依赖**：T6
- **目标产出**：`/content` 目录、MD/MDX 渲染、代码高亮等
- **关键动作**：接入 `next-mdx-remote` 或 Contentlayer → rehype/remark 插件（slug/autolink/toc）→ 代码复制按钮
- **验收**：构建生成静态页；文章内 TOC 与复制按钮可用

### T8 模板库（可筛选）

- **依赖**：T6、T7
- **目标产出**：模板卡片页、过滤组件、URL 查询直链
- **关键动作**：定义模板 schema → 读取 JSON → 客端过滤 → 组合筛选可分享 → 卡片含复制/下载
- **验收**：筛选组合更改 URL 并可分享；卡片操作可用

### T9 隐私政策/用户协议/Cookie 提示

- **依赖**：T6
- **目标产出**：隐私/协议页面、首屏 Cookie banner（同意/拒绝/偏好）
- **关键动作**：渲染静态文案 → Banner 存储同意状态 → 提供撤回入口
- **验收**：首次访问出现；可重新设置；文案可查
- **进展**：隐私政策与用户协议已补充正式条款，新增 `/cookies` 页面、可重新打开的 Cookie 偏好面板，并在页脚提供“管理 Cookie 偏好”入口；GitHub 代码已同步更新至当前实现。

### T10 评论系统（先关后开）+ 敏感词

- **依赖**：T9
- **目标产出**：Waline/Twikoo 自托管评论 + 审核/敏感词机制
- **关键动作**：部署后端 → 前端嵌入 → 默认人工审核 → 敏感词过滤 → 举报入口
- **验收**：未审核不展示；后台可删改；举报流程通畅

### T11 统计与事件埋点

- **依赖**：T6
- **目标产出**：百度统计 + 自研 `track()` 工具
- **关键动作**：植入 Tongji → 设计事件（`article_read_depth` 等）→ 采样与去抖
- **验收**：控制台能看到 PV/UV/关键事件；事件无重复上报

### T12 RSS 与订阅（邮件/微信）

- **依赖**：T7
- **目标产出**：`/feed.xml`、邮件双重确认、退订流程
- **关键动作**：构建生成 RSS → 订阅表单 → Double Opt-in → DKIM/SPF 配置
- **验收**：RSS 校验通过；订阅邮件送达并可退订

### T13 站点地图与 robots

- **依赖**：T6、T7
- **目标产出**：`/sitemap.xml`、`/robots.txt`
- **关键动作**：构建期生成 → 包含全部文章 + 更新时间 → 单元测试验证
- **验收**：生产环境可访问；覆盖主要路由

### T14 结构化数据（JSON-LD）

- **依赖**：T6、T7
- **目标产出**：Article/Breadcrumb/FAQ/Code Schema 注入
- **关键动作**：基于路由注入 JSON-LD → 提供标题、作者、发布时间、更新日、字数等元信息
- **验收**：Google/Baidu 结构化测试通过，无报错

### T15 Baidu 站长平台接入与校验

- **依赖**：T13、T14
- **目标产出**：站点校验、自动推送
- **关键动作**：上传校验文件或 Meta → 配置主动推送 Token → CI 集成推送新 URL
- **验收**：资源平台显示已接入；首批链接提交成功

### T16 关键词与内容策略落地

- **依赖**：T7
- **目标产出**：`/seo/keywords.csv`、`/content/plan.json`，20 篇文章元信息
- **关键动作**：构建主题 × 场景 × 工具组合 → 批量生成标题/描述 → 内链规划 ≥3/篇
- **验收**：20 篇草稿具备标题/描述/内链；文稿内链齐全

### T17 本地化资源与可访问性

- **依赖**：T6
- **目标产出**：本地字体/图标、高亮包；A11y 基线
- **关键动作**：下载字体自托管 → `font-display: swap` → 图片 ALT → 键盘可达 → aXe 工具校验
- **验收**：离线可渲染核心 UI；A11y 检测通过

### T18 性能优化（LCP/CLS/INP）

- **依赖**：T6、T7、T17
- **目标产出**：Lighthouse 移动端 ≥ 90，LCP < 2.5s、CLS < 0.1
- **关键动作**：`next/image`、懒加载、代码分割、Gzip/Br、RUM 采集
- **验收**：真实设备抽测满足阈值

### T19 安全与合规（最小集）

- **依赖**：T6、T11
- **目标产出**：安全响应头、CSP 报警、表单最小化
- **关键动作**：在 `next.config.js` 或边缘层设置 X-Content-Type-Options、Referrer-Policy、HSTS、CSP (report-only) → 收集误报
- **验收**：安全头生效；CSP 报警可控

### T20 CI/CD 流水线（构建-上传-刷新）

- **依赖**：T2、T5
- **目标产出**：`.github/workflows/deploy.yml` 自动上传 OSS 并刷新 CDN
- **关键动作**：安装 `ossutil64` → `ossutil cp -r out oss://bucket/` → CDN 刷新 API → 失败报警
- **验收**：主分支合并即部署成功；失败有通知

### T21 自监控与错误追踪

- **依赖**：T11、T20
- **目标产出**：Sentry（或等价方案）错误面板、告警
- **关键动作**：SDK 集成 → Source Map 上传（仅错误收集）→ 告警 Webhook
- **验收**：错误可定位到版本与行号；告警能触达

### T22 灰度发布与回滚策略

- **依赖**：T20
- **目标产出**：`release.sh`、`rollback.sh`，版本化目录
- **关键动作**：产物带时间戳目录 `/releases/YYYY-MM-DD/` → CDN 灰度路由 → 缓存清理策略 → 回滚切换别名
- **验收**：回滚 < 5 分钟；灰度阶段有监控数据

### T23 上线前检查（清单）

- **依赖**：T13–T21
- **目标产出**：Node 脚本产出 JSON/HTML 报告
- **关键动作**：批量请求关键页面 → 校验元数据/结构化/安全头/性能阈值 → 聚合结果
- **验收**：报告全部通过或列出阻断项

### T24 发布与站外分发

- **依赖**：T15、T23
- **目标产出**：正式发布 + 站外矩阵分发
- **关键动作**：站内发布 → 公众号/知乎/掘金摘要同步 → 外链回流监测
- **验收**：首日收录若干 URL；站外导流有 PV

### T25 持续选题与反馈循环

- **依赖**：T7、T11
- **目标产出**：`/content/backlog.json`、选题看板
- **关键动作**：表单收集读者问题 → 文章底部接入 → 每周筛选 → 更新内容流水线
- **验收**：每周新增 2–3 篇选题；看板保持更新

---

## 推进节奏建议（示例）

- **第 1–2 周**：完成阶段 A（合规备案）并并行搭建阶段 B（工程脚手架）
- **第 3–5 周**：集中完成阶段 C、D，确保核心站点功能与互动闭环
- **第 6 周**：处理阶段 E、F 的 SEO、本地化、性能、安全优化
- **第 7 周**：完成阶段 G 的自动化部署、监控与灰度方案
- **第 8 周**：运行阶段 H 的上线检查、发布、分发，进入阶段性运营

> 备案类任务周期受外部审批影响，需提前安排。建议工程及内容条线并行推进，确保在备案通过时站点已具备交付能力。
